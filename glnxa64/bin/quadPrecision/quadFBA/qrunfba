#!/usr/bin/env bash
# qrunfba
# If necessary, make this file executable via chmod +x qrunfba.
# Note that file names of the form fort.* may be machine-dependent.
#
# 29 Apr 2014: qrunfba made from runfba for quadLP.
# 04 Nov 2014: Save fort.81 as PROB.sol.

TOP=".."   # ROOT OF THE QUADLP INSTALLATION

# Check arguments
if [ "$#" -lt 3 ]; then
  echo "  Script for running minos on a *.txt file in $TOP/data/FBA"
  echo "./qrunfba  qsolveLP TMA_ME lp2   runs  qsolveLP with TMA_ME.txt, lp2.spc"
  exit 1
fi

SOLVER="$1"
PROB="$2"
SPECS="$3"
FBA="$TOP/data/FBA/$PROB"

# Check input file
if [ ! -e "$FBA.txt" ]; then
  echo "Error: $FBA.txt not found"
  exit 1
fi

# Prepare fort.* files
cp -p   "$SPECS.spc"  fort.4
cp -p   "$FBA.txt"    fort.10
cp -fp  "$PROB.basis" fort.11 2>/dev/null || true

ls -l "${PROB}"*

# Run the specified executable
echo "  Running $TOP/bin/$SOLVER"
"$TOP/bin/$SOLVER"

# Collect outputs (q-prefixed)
cp -fp fort.9  "q${PROB}.out"
cp -fp fort.11 "q${PROB}.basis"       2>/dev/null || true
cp -fp fort.12 "q${PROB}.newbasis"    2>/dev/null || true
cp -fp fort.13 "q${PROB}.finalbasis"  2>/dev/null || true
cp -fp fort.

